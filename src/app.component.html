<div class="flex flex-col h-screen w-screen font-sans">
  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="fixed inset-0 bg-gray-900 bg-opacity-60 flex flex-col justify-center items-center z-50">
      <div class="w-16 h-16 border-4 border-t-blue-500 border-solid rounded-full animate-spin"></div>
      <p class="text-white text-lg mt-4">Processing...</p>
    </div>
  }

  <!-- Main Content -->
  @if (!pdfFileBuffer()) {
    <!-- Upload View -->
    <main class="flex-grow flex flex-col justify-center items-center p-4">
      <div class="bg-white rounded-2xl shadow-2xl p-8 sm:p-12 text-center max-w-lg w-full transform hover:scale-105 transition-transform duration-300">
        <svg class="w-24 h-24 mx-auto text-blue-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
        </svg>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">PDF Text Editor</h1>
        <p class="text-gray-600 mb-8">Upload, edit, and download your PDFs securely in your browser.</p>
        <input type="file" #fileInput (change)="onFileSelected($event)" accept=".pdf" class="hidden" />
        <button (click)="triggerFileUpload()" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300">
          Select PDF File
        </button>
      </div>
    </main>
  } @else {
    <!-- Editor View -->
    <header class="bg-slate-800 text-white p-2 flex items-center justify-between shadow-lg z-10 flex-wrap">
      <div class="text-lg font-bold ml-4">PDF Editor</div>
      <div class="flex items-center gap-2 sm:gap-4">
        <button (click)="goToPrevPage()" [disabled]="currentPage() <= 1" class="p-2 rounded-full hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <span class="text-sm">Page {{ currentPage() }} of {{ totalPages() }}</span>
        <button (click)="goToNextPage()" [disabled]="currentPage() >= totalPages()" class="p-2 rounded-full hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
      </div>
      <div class="flex items-center gap-2 sm:gap-4">
        <button (click)="zoomOut()" class="p-2 rounded-full hover:bg-slate-700 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6"></path></svg>
        </button>
        <span class="text-sm w-12 text-center">{{ roundedZoom() }}%</span>
        <button (click)="zoomIn()" class="p-2 rounded-full hover:bg-slate-700 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM7 10h6"></path></svg>
        </button>
      </div>
      <button (click)="downloadPdf()" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all mr-4">
        Download PDF
      </button>
    </header>
    
    <main class="flex-grow overflow-auto bg-slate-200 p-4 sm:p-8">
      <div class="relative mx-auto w-fit shadow-2xl bg-white">
        <canvas #pdfCanvas></canvas>
        <div class="absolute top-0 left-0 text-layer" [style.width.px]="canvasWidth()" [style.height.px]="canvasHeight()">
          @for (item of textItems(); track $index) {
            <div contenteditable="true"
                 class="absolute select-text p-0 m-0 leading-none whitespace-pre border border-transparent hover:border-blue-400 hover:border-dashed focus:outline-none focus:border-blue-500 focus:bg-blue-500/10"
                 [style.left.px]="item.transform[4] * zoom()"
                 [style.top.px]="item.transform[5] * zoom()"
                 [style.width.px]="item.width * zoom()"
                 [style.height.px]="item.height * zoom()"
                 [style.font-size.px]="item.height * zoom() * 0.9"
                 [style.line-height.px]="item.height * zoom()"
                 [style.font-family]="item.fontName"
                 (input)="updateText($index, $event)">{{ getEditedText($index) }}</div>
          }
        </div>
      </div>
    </main>
  }
</div>